$(function(){ // document ready
  $(".contacts").each(function(e) {
    $("#btn_contact_send_mail").on("click",function(){
      $('#btn_contact_send_mail').attr('disabled', '');
      <% if Rails.env.production? %>
        ga('send', 'event', 'Contact', 'Contact Form', '');
      <% end %>
      var txtmessage = $("#txt_contact_message").val();
      var txt_locale = $('#locale')[0].innerHTML;
      $.ajax({
        type: "POST",
        beforeSend: function(xhr) {xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'))},
        url: "/" + txt_locale + "/contactos",
        data: { contact: { 
          email: $('input[name=txt_contact_email]').val(), 
          name: $('input[name=txt_contact_name]').val(), 
          phone: $('input[name=txt_contact_phone]').val(), 
          contact_type: "CONTACT", 
          message: txtmessage
           } },
        success: function(){
          $('input[name=txt_contact_email]').val('');
          $('input[name=txt_contact_name]').val('');
          $('input[name=txt_contact_phone]').val('');
          $('#txt_contact_message').val('');
          $('#contact-alert').hide();
          $("label[for='contact-error']").html('');
          $('#contact-thanks').show();
        },
        error: function(resp){
          var errors = $.parseJSON(resp.responseText).errors;
          $('#btn_contact_send_mail').removeAttr('disabled');
          $('#contact-alert').show();
          $("label[for='contact-error']").html(errors);
         }
      });
     });
  });  
});
